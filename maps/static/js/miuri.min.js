(function(){var t,r,e,o,n,s,i,p,u,a,h,c={}.hasOwnProperty;h=/^(?:([A-Za-z-+\.]+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/,a=["protocol","username","password","host","port","path","query","fragment"],s="undefined"!=typeof window&&null!==window?!1:!0,p=function(t){var r,e,o,n,s,i;if(!h.test(t))throw"Invalid uri";for(e=h.exec(t).slice(1),n={},r=s=0,i=a.length;i>s;r=++s)o=a[r],n[o]=e[r];return n},n=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return"[object Object]"===Object.prototype.toString.call(t)},o=function(t,r){var e,o;for(e in r)c.call(r,e)&&(o=r[e],t[e]=o)},u=function(t){var r,e,o,s,p,u,a,h,c,f;for(e=/\[([^\]]*)\]/,r={},c=t.split("&"),a=0,h=c.length;h>a;a++)s=c[a],f=s.split("="),o=f[0],u=f[1],p=e.exec(o),u=decodeURIComponent(u),p?(p[1]&&!i(r[o])?r[o]={}:n(r[o])||(r[o]=[]),p[1]?r[o][p[1]]=u:r[o].push(u)):r[o]=u;return r},e=function(t,r){var e,o,s,p;if(!n(r)&&!i(r))return""+t+"="+encodeURIComponent(r);if(a=[],n(r))for(s=0,p=r.length;p>s;s++)e=r[s],a.push(""+t+"[]="+encodeURIComponent(e));if(i(r))for(o in r)c.call(r,o)&&(e=r[o],a.push(""+t+"["+o+"]="+encodeURIComponent(e)));return a.join("&")},r="/","undefined"!=typeof window&&null!==window&&window.location.host&&(r=window.location.href),t=function(){function t(t){this.uri=null!=t?t:r,this.parts=p(this.uri),this.parts.query=this.parts.query?u(this.parts.query):{},this.parts.path||(this.parts.path="/")}return t.prototype.retrieve=function(t,r){return null==r&&(r=null),null===r?this.parts[t]:(this.parts[t]=r,this)},t.prototype.protocol=function(t){return this.retrieve("protocol",t)},t.prototype.username=function(t){return this.retrieve("username",t)},t.prototype.password=function(t){return this.retrieve("password",t)},t.prototype.host=function(t){return this.retrieve("host",t)},t.prototype.port=function(t){return this.retrieve("port",t)},t.prototype.path=function(t){return t&&"/"!==t[0]&&(t="/"+t),this.retrieve("path",t)},t.prototype.query=function(t,r){return t&&"string"==typeof t?r?(this.parts.query[t]=r,this):this.parts.query[t]:i(t)?(o(this.parts.query,t),this):this.parts.query},t.prototype.fragment=function(t){return this.retrieve("fragment",t)},t.prototype.toString=function(){var t,r,o,n,s;o="",this.parts.protocol&&this.parts.host&&(o+=""+this.parts.protocol+"://",this.parts.username&&this.parts.password?o+=""+this.parts.username+":"+this.parts.password+"@":this.parts.username&&(o+=""+this.parts.username+"@"),o+=this.parts.host,this.parts.port&&(o+=":"+this.parts.port)),o+=this.parts.path,r=[],s=this.parts.query;for(t in s)c.call(s,t)&&(n=s[t],r.push(e(t,n)));return r.length>0&&(o+="?"+r.join("&")),this.parts.fragment&&(o+="#"+this.parts.fragment),o},t}(),s?module.exports=t:this.miuri=t}).call(this);